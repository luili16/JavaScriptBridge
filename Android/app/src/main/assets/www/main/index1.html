<!DOCTYPE html>
<html>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<meta name="viewport" content="width=width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0" />
	<head>
		<meta charset="utf-8" />
		<title></title>
		<!--<script type="text/javascript" src="js_bridge_es5.js"></script>-->
		<script type="text/javascript" src="md5.js"></script>
		<script type="application/javascript">

			window.RCJSBridgeInitFinishCallback = function() {
				alert("初始化完成!!!");
			}
			window.RCAndroidJSBridgeHandler.globalInit()

			function passNumberToNative() {
				window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是 " + response.data);
					alert("success  返回值是 " + response.data);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"TestPlugin","passNumberToNative",[123,3.1415926,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER]);
			}

			function passBooleanToNative() {
				window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是 " + response.data);
					alert("success  返回值是 " + response.data);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"TestPlugin","passBooleanToNative",[false]);
			}

			function passStringToNative() {
				window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是 " + response.data);
					alert("success  返回值是 " + response.data);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"TestPlugin","passStringToNative",["hello world!"]);
			}

			function passArrayToNative() {
				window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是 " + response.data);
					alert("success  返回值是 " + response.data);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"TestPlugin","passArrayToNative",[["hello world",123,3.1345555]]);
			}

			function passObjectToNative() {

				var obj = {
					"user":"lixin",
					"info":"this is a description",
					"account":1234,
					"map":{
						"map0":"map0",
						"map1":"map1"
					},
					"array":[
						"abc",
						"def",
						456
					]
				};

				window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是 " + response.data);
					alert("success  返回值是 " + response.data);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"TestPlugin","passObjectToNative",[obj]);
			}

			function passActionToNative() {
				window.RCJSBridge.callAction(function success(response){
					alert("success 返回值是 " + response.data);
				},function error(response){
					console.log("error : " + response.data);
				},"customAction1",[123,"456"]);
			}

			function passArrayBufToNative() {
				
				var arr = [0x15,0xFF,0x01,0x00,0x34,0xAB,0x11,0x12,0x14,0x19];
				var uint8 = new Uint8Array(arr);
				var buffer = uint8.buffer;
				var base64 = window.RCJSBridge._fromArrayBuffer(buffer);
				console.log("base64: " + base64);
				
				window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是 " + response.data);
					alert("success  返回值是 " + response.data);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"TestPlugin","passArrayBufToNative",[base64,buffer]);
			
			}

			function passNullArgToNative() {
				window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是 " + response.data);
					alert("success  返回值是 " + response.data);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"TestPlugin","passNullToNative",[null]);
			}

			function passEmptyArgToNative() {
				window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是 " + response.data);
					alert("success  返回值是 " + response.data);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"TestPlugin","passEmptyToNative",[]);
			}

			function callbackNumberFromNative() {
				window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是 " + response.data);
					alert("success  返回值是 " + response.data);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"CallbackPlugin","callbackNumberFromNative",["abc"]);
			}

			function callbackStringFromNative() {
				window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是 " + response.data);
					alert("success  返回值是 " + response.data);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"CallbackPlugin","callbackStringFromNative",["abc"]);
			}

			function callbackArrayFromNative() {
				window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是 " + response.data);
					alert("success  返回值是 " + response.data);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"CallbackPlugin","callbackArrayFromNative",["abc"]);

			}

			function callbackObjFromNative() {
				window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是 " + response.data);
					alert("success  返回值是 " + response.data);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"CallbackPlugin","callbackObjFromNative",["abc"]);

			}

			function callbackArrayBufferFromNative() {
			window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是 " + response.data);
					var _rawmd5 = md5('hello android world');
					var _retval = md5(new Uint8Array(response.data));
					if (_retval === _rawmd5) {
						alert("success  md5 校验成功");
					} else {
						alert("success  md5 校验失败");
					}

					console.log("md5 : " + _retval);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"CallbackPlugin","callbackArrayBufferFromNative",["abc"]);
			}

			function callbackVoidFromNative() {
			window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是应该为null:" + (response.data===null));
					alert("success  返回值是应该为null:" + (response.data===null));
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"CallbackPlugin","callbackVoidFromNative",["abc"]);
			}

			function keepCallbackFromString() {
			window.RCJSBridge.exec(function success(response){
					console.log("success  返回值是:" + response.data);
					alert("success  返回值是:" + response.data);
				},function error(response){
					console.log("error : " + response.data);
					alert("error : " + response.data);
				},"CallbackPlugin","keepCallbackFromString",["abc"]);
			}

			function concurrentTest() {
				console.log("call concurrentTest");
				var _EchoMethods = ["method0","method1","method2","method3","method4"];
				var _EchoPlugins = ["EchoPlugin0","EchoPlugin1"];
				var _taskMap = {};
				var _showTask = document.getElementById('task_count_id');
				// 循环将任务发送出去
				var _taskCount = 50;
				for (var _i = 0; _i < _taskCount; _i++) {
					var _echoPlugin = _EchoPlugins[getRandomInt(2)];
					var _echoMethod = _EchoMethods[getRandomInt(5)];
					_taskMap[_i.toString()] = _i;
					window.RCJSBridge.exec(
						function success(response){
							delete _taskMap[response.data.toString()];
							console.log("剩余任务数: " + Object.keys(_taskMap).length);
							_showTask.innerText = "剩余任务数: " + Object.keys(_taskMap).length;
						},
						function error(response){
							console.log("出现错误!!!!!!");
						},
						_echoPlugin,
						_echoMethod,
						[_i]);
				}
			}

			function getRandomInt(max) {
				return Math.floor(Math.random() * Math.floor(max));
			}



		</script>
	</head>
	<body>
		<div>hello htlm5</div>
		<button onclick="passNumberToNative()">passNumberToNative1</button></br>
		<button onclick="passStringToNative()">passStringToNative1</button></br>
		<button onclick="passBooleanToNative()">passBooleanToNative1</button></br>
		<button onclick="passArrayToNative()">passArrayToNative1</button></br>
		<button onclick="passObjectToNative()">passObjectToNative1</button></br>
		<button onclick="passActionToNative()">passActionToNative1</button></br>
		<button onclick="passNullArgToNative()">passNullToNative1</button></br>
		<button onclick="passEmptyArgToNative()">passEmptyToNative1</button></br>
		<button onclick="passArrayBufToNative()">passArrayBufToNative1</button></br>
		<button onclick="callbackNumberFromNative()">callbackNumberFromNative1</button></br>
		<button onclick="callbackStringFromNative()">callbackStringFromNative1</button></br>
		<button onclick="callbackArrayFromNative()">callbackArrayFromNative1</button></br>
		<button onclick="callbackObjFromNative()">callbackObjFromNative1</button></br>
		<button onclick="callbackArrayBufferFromNative()">callbackArrayBufferFromNative1</button></br>
		<button onclick="callbackVoidFromNative()">callbackVoidFromNative1</button></br>
		<button onclick="keepCallbackFromString()">keepCallbackFromString1</button></br>
		<button onclick="concurrentTest()">concurrentTest1</button></br>
		<div id="task_count_id"></div>
	</body>
</html>
